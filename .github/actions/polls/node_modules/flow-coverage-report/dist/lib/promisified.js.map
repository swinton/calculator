{"version":3,"sources":["../../src/lib/promisified.js"],"names":["exec","mkdirp","readFile","writeFile","glob","withTmpDir","track","command","options","extra","Promise","resolve","reject","err","stdout","stderr","dontReject","path","buff","data","pattern","files","tempFileId","mkdir","dirPath"],"mappings":"AAAA;;;;;QAiBgBA,I,GAAAA,I;QAmBAC,M,GAAAA,M;QAYAC,Q,GAAAA,Q;QAYAC,S,GAAAA,S;QAmBAC,I,GAAAA,I;QAYAC,U,GAAAA,U;;AAvFhB;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA;AACA,eAAKC,KAAL,G,CAGkD;AAG3C,SAASN,IAAT,CACLO,OADK,EACYC,OADZ,EAELC,KAFK,EAGgB;AACrB,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,6BAASL,OAAT,EAAkBC,OAAlB,EAA2B,UAACK,GAAD,EAAMC,MAAN,EAAcC,MAAd,EAAyB;AAClD,UAAIF,GAAJ,EAAS;AACP,YAAIJ,SAASA,MAAMO,UAAnB,EAA+B;AAC7BL,kBAAQ,EAACE,QAAD,EAAMC,cAAN,EAAcC,cAAd,EAAR;AACD,SAFD,MAEO;AACLH,iBAAOC,GAAP;AACD;AACF,OAND,MAMO;AACLF,gBAAQ,EAACG,cAAD,EAASC,cAAT,EAAR;AACD;AACF,KAVD;AAWD,GAZM,CAAP;AAaD;;AAEM,SAASd,MAAT,CAAgBgB,IAAhB,EAA6C;AAClD,SAAO,IAAIP,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,0BAAUK,IAAV,EAAgB,eAAO;AACrB,UAAIJ,GAAJ,EAAS;AACPD,eAAOC,GAAP;AACD,OAFD,MAEO;AACLF;AACD;AACF,KAND;AAOD,GARM,CAAP;AASD;;AAEM,SAAST,QAAT,CAAkBe,IAAlB,EAAiD;AACtD,SAAO,IAAIP,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,iBAAGV,QAAH,CAAYe,IAAZ,EAAkB,UAACJ,GAAD,EAAMK,IAAN,EAAe;AAC/B,UAAIL,GAAJ,EAAS;AACPD,eAAOC,GAAP;AACD,OAFD,MAEO;AACLF,gBAAQO,IAAR;AACD;AACF,KAND;AAOD,GARM,CAAP;AASD;;AAEM,SAASf,SAAT,CAAmBc,IAAnB,EAAiCE,IAAjC,EAAqE;AAC1E,SAAO,IAAIT,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,iBAAGT,SAAH,CAAac,IAAb,EAAmBE,IAAnB,EAAyB,eAAO;AAC9B,UAAIN,GAAJ,EAAS;AACPD,eAAOC,GAAP;AACD,OAFD,MAEO;AACLF;AACD;AACF,KAND;AAOD,GARM,CAAP;AASD;;AASM,SAASP,IAAT,CAAcgB,OAAd,EAA+BZ,OAA/B,EAA4E;AACjF,SAAO,IAAIE,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,wBAAQQ,OAAR,EAAiBZ,OAAjB,EAA0B,UAACK,GAAD,EAAMQ,KAAN,EAAgB;AACxC,UAAIR,GAAJ,EAAS;AACPD,eAAOC,GAAP;AACD,OAFD,MAEO;AACLF,gBAAQU,KAAR;AACD;AACF,KAND;AAOD,GARM,CAAP;AASD;;AAEM,SAAShB,UAAT,CAAoBiB,UAApB,EAAyD;AAC9D,SAAO,IAAIZ,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,mBAAKW,KAAL,CAAWD,UAAX,EAAuB,UAACT,GAAD,EAAMW,OAAN,EAAkB;AACvC,UAAIX,GAAJ,EAAS;AACPD,eAAOC,GAAP;AACD,OAFD,MAEO;AACLF,gBAAQa,OAAR;AACD;AACF,KAND;AAOD,GARM,CAAP;AASD","file":"promisified.js","sourcesContent":["'use strict';\n\n// @flow\n\nimport {exec as nodeExec} from 'child_process';\nimport fs from 'fs';\nimport npmGlob from 'glob';\nimport npmMkdirp from 'mkdirp';\nimport temp from 'temp';\n\n// Automatically cleanup temp file on process.exit\ntemp.track();\n\nexport type ExecResult = {err?: Error, stdout?: string|Buffer, stderr?: string|Buffer};\nexport type ExecOptions = child_process$execOpts; // eslint-disable-line camelcase\nexport type ExecExtras = {dontReject?: boolean};\n\nexport function exec(\n  command: string, options: ExecOptions,\n  extra: ?ExecExtras\n): Promise<ExecResult> {\n  return new Promise((resolve, reject) => {\n    nodeExec(command, options, (err, stdout, stderr) => {\n      if (err) {\n        if (extra && extra.dontReject) {\n          resolve({err, stdout, stderr});\n        } else {\n          reject(err);\n        }\n      } else {\n        resolve({stdout, stderr});\n      }\n    });\n  });\n}\n\nexport function mkdirp(path: string): Promise<void> {\n  return new Promise((resolve, reject) => {\n    npmMkdirp(path, err => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\nexport function readFile(path: string): Promise<Buffer> {\n  return new Promise((resolve, reject) => {\n    fs.readFile(path, (err, buff) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(buff);\n      }\n    });\n  });\n}\n\nexport function writeFile(path: string, data: string|Buffer): Promise<void> {\n  return new Promise((resolve, reject) => {\n    fs.writeFile(path, data, err => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\nexport type GlobOptions = {\n  cwd?: string,\n  root?: string,\n};\n\nexport type GlobFilelist = Array<string>;\n\nexport function glob(pattern: string, options: GlobOptions): Promise<GlobFilelist> {\n  return new Promise((resolve, reject) => {\n    npmGlob(pattern, options, (err, files) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(files);\n      }\n    });\n  });\n}\n\nexport function withTmpDir(tempFileId: string): Promise<string> {\n  return new Promise((resolve, reject) => {\n    temp.mkdir(tempFileId, (err, dirPath) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(dirPath);\n      }\n    });\n  });\n}\n"]}